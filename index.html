
<!DOCTYPE html>
<html>
  <head>
    <title>Xiang Nan's Blog</title>
    <link href="https://cdn.bootcss.com/bootstrap/4.0.0-alpha.6/css/bootstrap-grid.css" rel="stylesheet">
    </head>
  <body>
  <div id="app">
    <p>
      <!-- use router-link component for navigation. -->
      <!-- specify the link by passing the `to` prop. -->
      <!-- `<router-link>` will be rendered as an `<a>` tag by default -->
      <router-link to="/foo">Go to Foo</router-link>
      <router-link to="/bar">Go to Bar</router-link>
    </p>
    <router-view></router-view>
  </div>
<script src="https://cdn.bootcss.com/vue/2.3.4/vue.min.js"></script>
<script src="https://cdn.bootcss.com/vue-router/2.6.0/vue-router.min.js"></script>
<script src="https://cdn.bootcss.com/vue-resource/1.3.4/vue-resource.min.js"></script>

<script type="text/javascript">
var PREFIX = 'https://api.github.com/repos/xiangnanscu/lua-resty-mvc/contents'

var d = `
<div>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      文章
    </h3>
  </div>
  <div class="panel-body">
    <table class="table table-hover">
      <tbody>
        <tr v-for="file in files">
          <td>
            <router-link :to="'/file'+file.path" class="btn btn-primary" role="button">{{file.name}}</router-link>
          </td>
          <td>
            ok
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      类别
    </h3>
  </div>
  <div class="panel-body">
    <ul v-for="folder in folders" class="nav nav-pills nav-stacked">
      <li role="presentation">
        <router-link :to="'/folder'+folder.path">{{folder.name}}</router-link>
      </li>
    </ul>
  </div>
</div>
</div>
`

var folderView = {
    template: d,
    props: {
        path: {type: String, default: ''},
    },
    data: {
        tree: [{type: 'file', name: 'hello.lua'}, {type: 'dir', name: 'lib'}],
    },
    updated: function () {
      console.log('updated.')
    },
    mounted: function () {
      console.log('this.files', this.files)
      console.log('this.folders', this.folders)
      // console.log('mounted..'+this.path)
      // var self = this
      // Vue.http.get(PREFIX + this.path).then(
      //   function(response){
      //     self.tree = response.body
      //     console.log('success set tree', self.tree)
      //   },
      //   function(response){
      //     alert('Fail to get tree')
      //   }
      // ); 
    },
    computed: {
      files: function () {
        console.log('computed files', this.tree)
        this.tree =  [{type: 'file', name: 'hello.lua'}, {type: 'dir', name: 'lib'}]
        return this.tree.filter(
          function (e) {
            return e.type == 'file'
          }
        ).map(
          function (e) {
            return e
          }
        )
      },
      folders: function () {
        console.log('computed folder')
        return this.tree.filter(
          function (e) {
              return e.type == 'dir'
          }
        ).map(
          function (e) {
              return e
          }
        )
      },    
    },
}

var fileView = {
    template: `<h1>123</h1>`,
    props: {
        path: {type: String, default: ''}
    },
}



var router = new VueRouter({
  linkActiveClass: "router-link-active",
  linkExactActiveClass: "router-link-exact-active",
  routes: [

    {
      path: '/', 
      component: folderView,
      props: {path: ''},
    },
    {
      path: '/folder/:path', 
      component: folderView,
      props: function (route) {
        return {path: route.params.path}
      },
    },
    {
      path: '/file/:path', 
      component: fileView,
      props: function (route) {
        return {path: route.params.path}
      },
    },
  ],
})

var app = {
  router: router,

}
new Vue(app).$mount('#app')

  </script>
</body>
</html>